<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursos y Simposios HRAEI 2026</title>
    <link rel="stylesheet" href="css/styles2.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;800&display=swap" rel="stylesheet">
    <style>
        /* Estilo simple para ocultar elementos */
        .hidden { display: none; }
        /* Ajuste para inputs condicionales */
        .conditional-input { margin-top: 10px; width: 100%; }
    </style>
</head>
<body>
<div class="portada">
    <header class="header">
        <div class="logo">
            <img src="assets/imagenes/logo_HRAEI.png" alt="Hospital Regional">
        </div>
    </header>

    <section class="contenido">
        <h1>Cursos y Simposios<br><span>HRAEI 2026</span></h1>
    </section>

    <div class="form-panel" id="datos-personales">
        <h2 class="panel-title">Datos Personales</h2>
        <div class="field full"><label>Nombre (s):</label><input type="text" id="nombre"></div>
        <div class="field half left"><label>Apellido Paterno:</label><input type="text" id="apellido-paterno"></div>
        <div class="field half right"><label>Apellido Materno:</label><input type="text" id="apellido-materno"></div>
        <div class="field full"><label>Correo Electrónico:</label><input type="email" id="correo"></div>
        <div class="field half left"><label>Teléfono:</label><input type="text" id="telefono"></div>
        <div class="field half right"><label>Entidad Federativa:</label><input type="text" id="estado"></div>
        <div class="field half left"><label>Fecha de nacimiento:</label><input type="date" id="fecha-nacimiento"></div> <div class="field half right"><label>Género:</label><input type="text" id="genero"></div>

        <div class="field radio left">
            <label>¿Padece alguna discapacidad?</label>
            <div class="options">
                <input type="radio" name="discapacidad" id="discapacidad-si" value="Sí" onchange="toggleDiscapacidad(true)">
                <label for="discapacidad-si">Sí</label>
                <input type="radio" name="discapacidad" id="discapacidad-no" value="No" onchange="toggleDiscapacidad(false)">
                <label for="discapacidad-no">No</label>
            </div>
            <input type="text" id="especificar-discapacidad" class="conditional-input hidden" placeholder="Especifique cuál...">
        </div>

        <div class="field radio right">
            <label>¿Pertenece a un grupo indígena?</label>
            <div class="options">
                <input type="radio" name="indigena" id="indigena-si" value="Sí" onchange="toggleIndigena(true)">
                <label for="indigena-si">Sí</label>
                <input type="radio" name="indigena" id="indigena-no" value="No" onchange="toggleIndigena(false)">
                <label for="indigena-no">No</label>
            </div>
            <input type="text" id="especificar-lengua" class="conditional-input hidden" placeholder="Especifique lengua...">
        </div>

        <div class="field half left"><label>Contraseña:</label><input type="password" id="contrasena"></div>
        <div class="field half right"><label>Confirmar contraseña:</label><input type="password" id="confirmar-contrasena"></div>

        <button class="btn" id="btn-continuar">Continuar</button>
        <div style="text-align: center; margin-top: 10px;">
             <a href="inicio_sesion.html" style="color: white;">¿Ya tienes cuenta? Inicia sesión</a>
        </div>
    </div>

    <div class="form-panel" id="datos-academicos" style="display: none;">
        <h2 class="panel-title">Datos académicos</h2>
        <div class="field full"><label>Institución de procedencia:</label><input type="text" id="institucion"></div>
        <div class="field full"><label>Área de especialidad:</label><input type="text" id="especialidad"></div>
        <div class="field full"><label>Nivel académico:</label><input type="text" id="nivel-academico"></div>

        <div class="field radio left">
            <label>¿Eres trabajador del HRAEI?</label>
            <div class="options">
                <input type="radio" name="trabajador-hraei" id="trabajador-si" value="Sí" onchange="toggleTrabajador(true)">
                <label for="trabajador-si">Sí</label>
                <input type="radio" name="trabajador-hraei" id="trabajador-no" value="No" onchange="toggleTrabajador(false)">
                <label for="trabajador-no">No</label>
            </div>
            <input type="number" id="numero-empleado" class="conditional-input hidden" placeholder="Número de empleado (5-10 dígitos)">
        </div>

        <button onclick="registrarUsuario()" class="btn">Crear cuenta</button>
        <button onclick="volverAtras()" class="btn" style="background-color: #666; margin-top: 10px;">Atrás</button>
    </div>

    <script>
        // Funciones para mostrar/ocultar campos
        function toggleDiscapacidad(mostrar) {
            const input = document.getElementById('especificar-discapacidad');
            input.style.display = mostrar ? 'block' : 'none';
            if (!mostrar) input.value = ''; // Limpiar si selecciona No
        }

        function toggleIndigena(mostrar) {
            const input = document.getElementById('especificar-lengua');
            input.style.display = mostrar ? 'block' : 'none';
            if (!mostrar) input.value = '';
        }

        function toggleTrabajador(mostrar) {
            const input = document.getElementById('numero-empleado');
            input.style.display = mostrar ? 'block' : 'none';
            if (!mostrar) input.value = '';
        }

        function volverAtras() {
            document.getElementById('datos-academicos').style.display = 'none';
            document.getElementById('datos-personales').style.display = 'flex'; // O 'block' dependiendo de tu CSS
        }

        document.getElementById('btn-continuar').addEventListener('click', function() {
            // Validaciones básicas parte 1
            const pass = document.getElementById("contrasena").value;
            const confirm = document.getElementById("confirmar-contrasena").value;
            
            // Validar condicionales
            const discap = document.querySelector('input[name="discapacidad"]:checked');
            const indigena = document.querySelector('input[name="indigena"]:checked');

            if (!discap || !indigena) {
                alert("Por favor responda las preguntas de Sí/No");
                return;
            }

            if (discap.value === "Sí" && document.getElementById("especificar-discapacidad").value.trim() === "") {
                alert("Por favor especifique su discapacidad");
                return;
            }

            if (indigena.value === "Sí" && document.getElementById("especificar-lengua").value.trim() === "") {
                alert("Por favor especifique su lengua indígena");
                return;
            }

            if (pass !== confirm || pass === "") {
                alert("Las contraseñas no coinciden o están vacías");
                return;
            }

            // Si pasa, cambia de panel
            document.getElementById('datos-personales').style.display = 'none';
            document.getElementById('datos-academicos').style.display = 'flex';
        });

        async function registrarUsuario() {
            // Recolección de datos
            const institucion = document.getElementById("institucion").value;
            const trabajadorOpt = document.querySelector('input[name="trabajador-hraei"]:checked');
            
            if (!trabajadorOpt) {
                alert("Seleccione si es trabajador HRAEI"); return;
            }

            let numEmpleado = "";
            if (trabajadorOpt.value === "Sí") {
                numEmpleado = document.getElementById("numero-empleado").value;
                // Validación 5 a 10 dígitos
                if (!/^\d{5,10}$/.test(numEmpleado)) {
                    alert("El número de empleado debe tener entre 5 y 10 dígitos numéricos.");
                    return;
                }
            }

            // Objeto con TODOS los datos
            const datos = {
                nombre: document.getElementById("nombre").value,
                apellidoPaterno: document.getElementById("apellido-paterno").value,
                apellidoMaterno: document.getElementById("apellido-materno").value,
                correo: document.getElementById("correo").value,
                telefono: document.getElementById("telefono").value,
                estado: document.getElementById("estado").value,
                fechaNacimiento: document.getElementById("fecha-nacimiento").value,
                genero: document.getElementById("genero").value,
                discapacidad: document.querySelector('input[name="discapacidad"]:checked').value,
                descDiscapacidad: document.getElementById("especificar-discapacidad").value,
                indigena: document.querySelector('input[name="indigena"]:checked').value,
                lenguaIndigena: document.getElementById("especificar-lengua").value,
                contrasena: document.getElementById("contrasena").value,
                institucion: document.getElementById("institucion").value,
                especialidad: document.getElementById("especialidad").value,
                nivelAcademico: document.getElementById("nivel-academico").value,
                trabajador: trabajadorOpt.value,
                numEmpleado: numEmpleado
            };

            // Enviar a PHP
            try {
                const response = await fetch('register.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert("¡Cuenta creada exitosamente!");
                    window.location.href = "inicio_sesion.html";
                } else {
                    alert("Error: " + result.message);
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Hubo un error de conexión.");
            }
        }
    </script>
</body>
</html>